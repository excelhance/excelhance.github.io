<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lâ€™Archiviste - jeu solo</title>
<style>
  
/* ===== BASE ===== */
body {
  background:#0f172a;
  color:#e5e7eb;
  padding:16px;
  font-family:system-ui;
}

h1 { text-align:center; margin-bottom:12px; }

button {
  cursor: pointer; /* boutons cliquables */
  width:100%;
  padding:12px;
  margin-bottom:8px;
  border:none;
  border-radius:10px;
  background:#38bdf8;
  color:#0f172a;
  font-weight:bold;
  transition: all 0.2s;
}

/* ===== POPUP 10 + AS ===== */
#popup-10as {
  background:#020617;
  border:2px solid #38bdf8;
  border-radius:12px;
  padding:10px;
  margin-bottom:12px;
}

.popup-10as .cartes{
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-bottom: 8px;
}
#popup-10as .carte {
  pointer-events: none;
  cursor: default;
}

#popup-10as button {
  width:48%;
  cursor: pointer; /* boutons cliquables */
}

/* Bouton Joker actif/inactif */
button.joker-actif { background:#fff; color:#0f172a; }
button.joker-utilise { cursor: pointer; background:#dc2626; color:#fff; }

/* ===== ZONES ===== */
.zone {
  border:2px dashed #475569;
  border-radius:12px;
  padding:10px;
  margin-bottom:14px;
}

.zone-title { text-align:center; margin-bottom:6px; color:#94a3b8; }

.cartes {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
  min-height:110px;
}

/* ===== CARTES ===== */
.carte {
  width:70px;
  height:100px;
  background:#fff;
  border-radius:10px;
  color:#000;
  position:relative;
  box-shadow:0 4px 8px rgba(0,0,0,.4);
  cursor:pointer;
  transition: transform 0.2s, outline 0.2s;
}

.carte.rouge { color:#b91c1c }

.carte.selectionnee {
  outline:3px solid #38bdf8;
  transform:translateY(-6px);
}

.valeur { position:absolute; top:6px; left:6px; font-weight:bold; }
.centre { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:2rem; }

/* ===== ARCHIVES ===== */
.archives {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
}

.archive {
  border:2px solid #475569;
  border-radius:10px;
  padding:6px;
  position:relative;
}

.archive h3 { text-align:center; margin-bottom:4px; }

.archive-cartes {
  display:flex;
  flex-direction:column;
  gap:4px;
}

/* Compteur de cartes dans l'archive */
.archive .compteur {
    text-align: center;
    font-weight: bold;
    color: #06b6d4; /* bleu cyan */
    font-size: 0.9rem;
    margin-bottom: 4px; /* espace entre compteur et icÃ´ne de l'archive */
}

/* Cartes rÃ©duites dans les archives */
.archive-cartes .carte {
  width:42px;
  height:60px;
  font-size:0.8rem;
}

/* Animation re-pioche */
@keyframes slideIn {
  0% { transform: translateY(-30px); opacity:0; }
  100% { transform: translateY(0); opacity:1; }
}
.carte.repioche { animation: slideIn 0.4s ease forwards; }

/* Joker marqueur */
.joker-marqueur {
  position:absolute;
  top:2px;
  right:2px;
  font-size:1rem;
}

/* pour bloquer les 3 boutons de jeu en prÃ©sence de la popup As+10 */
.ui-bloquee {
  pointer-events: none;
  opacity: 0.6;
}
/* pour bloquer les 3 boutons de jeu une fois la pop-up Victoire affichÃ©e */
body.ui-bloquee *:not(#rejouer) {
  pointer-events: none;
  opacity: 0.7;
}
#rejouer {
  pointer-events: auto ;
  opacity: 1 ;
}
</style>
</head>
<body>

<h1>ðŸ‚¡  Lâ€™Archiviste  ðŸ‚¡</h1>

<div id="zone-actions">
  <button id="piocher">PIOCHER</button>
  <button id="defausser">DÃ©fausser</button>
  <button id="joker">Activer Joker</button>
</div>

<button id="rejouer" style="display:none;background:#22c55e">
  REJOUER UNE PARTIE
</button>
  
<div id="popup-10as" style="display:none;"></div>

<div class="zone">
  <div class="zone-title">Zone Centrale</div>
  <div class="cartes" id="centre"></div>
</div>

<div class="zone">
  <div class="zone-title">Archives</div>
  <div class="archives">
    <div class="archive" data-c="â™ "><h3>â™ </h3><div class="archive-cartes"></div></div>
    <div class="archive" data-c="â™¥"><h3 style="color:#b91c1c">â™¥</h3><div class="archive-cartes"></div></div>
    <div class="archive" data-c="â™¦"><h3 style="color:#b91c1c">â™¦</h3><div class="archive-cartes"></div></div>
    <div class="archive" data-c="â™£"><h3>â™£</h3><div class="archive-cartes"></div></div>
  </div>
</div>

<script>
/* =====================================================
   Ã‰TAT GLOBAL
===================================================== */
const centre = document.getElementById("centre");
const btnPioche = document.getElementById("piocher");
const btnJoker = document.getElementById("joker");
let pioche = [];
let etat = "pioche";
let jokerUtilise = false;
let jokerEnAttente = false;
let premierePioche = true;
let attenteAction = false;
let vision10AsActive = false;
let cartesVision10As = [];

const archives = { "â™ ":[], "â™¥":[], "â™¦":[], "â™£":[] };
const couleurs = ["â™ ","â™¥","â™¦","â™£"];
const valeurs = [["A",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["10",10],["D",12],["R",13]];

/* =====================================================
   INITIALISATION PAQUET
===================================================== */
function creerPaquet(){
  pioche=[];
  couleurs.forEach(c=>{
    valeurs.forEach(v=>{
      pioche.push({ label:v[0], valeur:v[1], couleur:c });
    });
  });
  pioche.sort(()=>Math.random()-.5);
}

/* =====================================================
   CREATION CARTE HTML
===================================================== */
function creerCarteHTML(carte, interactive=true){
  const d=document.createElement("div");
  d.className="carte"+((carte.couleur==="â™¥"||carte.couleur==="â™¦")?" rouge":"");
  d.dataset.valeur = carte.valeur;
  d.dataset.label = carte.label;
  d.dataset.couleur = carte.couleur;
  d.innerHTML = `<div class="valeur">${carte.label}</div><div class="centre">${carte.couleur}</div>`;
  if(interactive) d.onclick = ()=>d.classList.toggle("selectionnee");
  return d;
}

/* =====================================================
   PIOCHE + RE-POCHE
===================================================== */
btnPioche.onclick = () => {
  const sel = [...document.querySelectorAll(".carte.selectionnee")];
  const premierePiocheAvantClic = premierePioche;

  let cartesADeposer;
  if(premierePioche){
      cartesADeposer = 2;
      premierePioche = false;
  } else if(attenteAction && sel.length===0 && !jokerEnAttente){
      // Re-pioche volontaire => pÃ©nalitÃ©
      cartesADeposer = 3;
  } else {
      // Pioche standard ou contrainte
      cartesADeposer = 2;
  }

  if(centre.children.length + cartesADeposer > 7){
      alert("Zone Centrale saturÃ©e, pioche impossible");
      return;
  }

  for(let i=0;i<cartesADeposer;i++){
      if(pioche.length && centre.children.length<7){
          const c = creerCarteHTML(pioche.pop());
          if(!premierePiocheAvantClic && attenteAction && sel.length===0 && !jokerEnAttente){
              c.classList.add("repioche");
          }
          centre.appendChild(c);
      }
  }

  etat="action";
  attenteAction = true;
};

/* =====================================================
   ARCHIVES
===================================================== */
document.querySelectorAll(".archive").forEach(archive => {
  archive.onclick = () => {

    // Gestion du Chaos (Joker en attente)
    if(jokerEnAttente){
      const arch = archives[archive.dataset.c];
      if(arch.length === 0) return;

      // Vider l'archive choisie et remettre ses cartes dans la pioche
      pioche.push(...arch);
      archives[archive.dataset.c] = [];
      renderArchive(archive.dataset.c);

      // Vider la Zone Centrale
      while(centre.firstChild){
        centre.removeChild(centre.firstChild);
      }

      // Marqueur visuel Joker (au-dessus du titre, sans dÃ©caler l'icÃ´ne)
      const marqueur = document.createElement("div");
      marqueur.className = "joker-marqueur";
      marqueur.textContent = "ðŸƒ";
      marqueur.style.position = "absolute";
      marqueur.style.top = "4px";
      marqueur.style.right = "4px";
      archive.querySelector("h3").appendChild(marqueur);

      // Changer visuel du bouton Joker
      const btnJoker = document.getElementById("joker");
      btnJoker.style.backgroundColor = "#dc2626"; // rouge lÃ©ger
      btnJoker.style.color = "#fff";

      jokerEnAttente = false;
      attenteAction = false;
      btnJoker.classList.remove("joker-actif");
      btnJoker.classList.add("joker-utilise");
      return;
    }

    // Classement d'une carte dans l'archive
    if(etat !== "action") return;
    const sel = [...document.querySelectorAll(".carte.selectionnee")];
    if(sel.length !== 1) return;
    const d = sel[0];
    if(d.dataset.couleur !== archive.dataset.c) return;

    archives[archive.dataset.c].push({
      valeur: +d.dataset.valeur,
      label: d.dataset.label,
      couleur: d.dataset.couleur
    });
    d.remove();
    renderArchive(archive.dataset.c);

    etat = "pioche";
    verifierVictoire();
    attenteAction = false;
  };
});

/* =====================================================
   RENDU ARCHIVES
===================================================== */
function renderArchive(c){
  const archiveDiv = document.querySelector(`.archive[data-c="${c}"]`);
  const cont = archiveDiv.querySelector(".archive-cartes");
  cont.innerHTML = "";

  // Tri et ajout des cartes
  archives[c]
      .sort((a,b) => a.valeur - b.valeur)
      .forEach(carte => { cont.appendChild(creerCarteHTML(carte,false)) });

  // ===== Compteur =====
  let compteurEl = archiveDiv.querySelector(".compteur");
  if(!compteurEl){
      compteurEl = document.createElement("div");
      compteurEl.className = "compteur";
      archiveDiv.insertBefore(compteurEl, archiveDiv.querySelector(".archive-cartes"));
  }
  compteurEl.textContent = archives[c].length;
}

/* =====================================================
   DÃ‰FAUSSE (RÃˆGLES COMPLÃˆTES UNIFIÃ‰ES)
===================================================== */
document.getElementById("defausser").onclick = () => {
    if(etat !== "action") return;

    const sel = [...document.querySelectorAll(".carte.selectionnee")];
    if(sel.length < 2) return;

    const v = sel.map(c => +c.dataset.valeur).sort((a,b) => a-b);

    // ===== MÃªme valeur =====
    if(v[0] === v[1]){
        sel.forEach(c => c.remove());
        etat = "pioche";
        attenteAction = false;  // pas de re-pioche automatique
        return;
    }

    // ===== 2 + 5 + 1 carte supplÃ©mentaire =====
    if(sel.length === 3){
        const vals = sel.map(c => +c.dataset.valeur);
        if(vals.includes(2) && vals.includes(5)){
            sel.forEach(c => c.remove());

            etat = "pioche";       // attente action utilisateur
            attenteAction = false;   // empÃªche re-pioche immÃ©diate
            return;
        }
    }

    // ===== 6 + 9 => dÃ©fausser les 2 cartes et rejouer SANS repiocher =====
    if(v[0] === 6 && v[1] === 9){
        sel.forEach(c => c.remove());  // DÃ©fausse des cartes
        return;  // rejouer immÃ©diatement, aucune pioche
    }

    // ===== 10 + Dame => retirer un Joker actif =====
    if(v[0] === 10 && v[1] === 12){
        if(jokerUtilise){
            // RÃ©initialisation Joker
            jokerUtilise = false;
            jokerEnAttente = false;
    
            // Bouton Joker -> Ã©tat normal
            btnJoker.classList.remove("joker-utilise","joker-actif");
            btnJoker.style.backgroundColor = "";
            btnJoker.style.color = "";
    
            // Suppression de lâ€™icÃ´ne Joker sur lâ€™archive
            document.querySelectorAll(".joker-marqueur").forEach(j => j.remove());
        }
    
        // DÃ©fausse des cartes
        sel.forEach(c => c.remove());
    
        etat = "pioche";
        attenteAction = false; // pioche standard ensuite
        return;
    }

    // ===== 10 + Roi =====
    if(v[0] === 10 && v[1] === 13){
        // Vider la Zone Centrale et retirer les cartes sÃ©lectionnÃ©es
        centre.innerHTML = "";
        sel.forEach(c => c.remove());

        etat = "pioche";       // attente de l'action utilisateur
        attenteAction = false;   // empÃªche re-pioche immÃ©diate
        return;
    }

    // ===== 10 + As =====
    if (v[0] === 1 && v[1] === 10) {
    
        // DÃ©fausse des cartes sÃ©lectionnÃ©es
        sel.forEach(c => c.remove());
    
        // PrÃ©lever jusquâ€™Ã  3 cartes (sÃ©curitÃ©)
        cartesVision10As = pioche.slice(-3);
    
        // Construction popup
        const popup = document.getElementById("popup-10as");
        popup.innerHTML = `
          <div class="cartes" style="display:flex;gap:6px;justify-content:center;margin-bottom:8px"></div>
          <div style="display:flex;gap:8px;justify-content:center">
            <button id="btn-conserver">Conserver (pioche suiv)</button>
            <button id="btn-remelanger">MÃ©langer sous la pile</button>
          </div>
        `;
    
        const zoneCartes = popup.querySelector(".cartes");
        cartesVision10As.forEach(c => {
            zoneCartes.appendChild(creerCarteHTML(c, false));
        });
    
        // Affichage forcÃ©
        popup.style.display = "block";
        popup.style.position = "relative";
        popup.style.zIndex = "50";
        vision10AsActive = true;

        // Blocage UI principale
        document.getElementById("zone-actions").classList.add("ui-bloquee");

        // Ã‰tat bloquant
        etat = "action";        // â¬…ï¸ IMPORTANT
        attenteAction = true;
    
        return;
    }
};
document.addEventListener("click", e => {
  if (!vision10AsActive) return;

  // === Conserver ===
  if (e.target.id === "btn-conserver") {
      // Les cartes restent au sommet
      fermerPopup10As();
  }

  // === Retour dans la pile ===
  if (e.target.id === "btn-remelanger") {

      // Retirer les cartes du sommet
      pioche.splice(-cartesVision10As.length, cartesVision10As.length);

      // RÃ©insertion alÃ©atoire
      pioche.push(...cartesVision10As);
      pioche.sort(() => Math.random() - 0.5);

      fermerPopup10As();
  }
});

function fermerPopup10As(){
  document.getElementById("popup-10as").style.display = "none";
  cartesVision10As = [];
  vision10AsActive = false;

  // DÃ©bloquer les boutons de jeu
  document.getElementById("zone-actions").classList.remove("ui-bloquee");

  // Reprise normale du jeu
  etat = "pioche";
  attenteAction = false;
}

/* =====================================================
   JOKER / CHAOS
===================================================== */
btnJoker.onclick = () => {
  if(jokerUtilise && !jokerEnAttente){
      //alert("âŒ DÃ©faite â€” Chaos incontrÃ´lÃ©");
      //location.reload();
      finDePartie("âŒ DÃ©faite â€” Chaos incontrÃ´lÃ©");
      return;
  }
  const nonVides = couleurs.filter(c=>archives[c].length);
  if(nonVides.length===0) return;

  jokerUtilise=true;
  jokerEnAttente=true;
  btnJoker.classList.add("joker-actif");
};

/* =====================================================
   FIN D'UNE PARTIE
===================================================== */
function finDePartie(message){
  alert(message);

  // Blocage total du jeu
  document.body.classList.add("ui-bloquee");

  // Masquer les boutons de jeu
  const zoneActions = document.getElementById("zone-actions");
  if(zoneActions){
    zoneActions.style.display = "none";
  }

  // Afficher le bouton Rejouer
  const btnReplay = document.getElementById("rejouer");
  if(btnReplay){
    btnReplay.style.display = "block";
    btnReplay.onclick = () => location.reload();
  }
}

/* =====================================================
   CONDITION DE VICTOIRE
===================================================== */
function verifierVictoire(){
  couleurs.forEach(c=>{
      if(archives[c].length===10){

          finDePartie("ðŸ† Archive stabilisÃ©e => VICTOIRE !");
          /*
          alert("ðŸ† Archive stabilisÃ©e => VICTOIRE !");

          // Blocage total du jeu
          document.body.classList.add("ui-bloquee");

          // Masquer boutons de jeu
          document.getElementById("zone-actions").style.display = "none";

          // Afficher bouton Rejouer
          const btnReplay = document.getElementById("rejouer");
          btnReplay.style.display = "block";
          btnReplay.onclick = () => location.reload();
          */
      }
  });
}

/* =====================================================
   LANCEMENT
===================================================== */
creerPaquet();
</script>
</body>
</html>
