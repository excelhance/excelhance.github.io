<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L‚ÄôArchiviste</title>

<style>
/* ===== BASE ===== */
body {
  background:#0f172a;
  color:#e5e7eb;
  padding:16px;
  font-family:system-ui;
}

h1 {
  text-align:center;
  margin-bottom:12px;
}

button {
  width:100%;
  padding:12px;
  margin-bottom:8px;
  border:none;
  border-radius:10px;
  background:#38bdf8;
  color:#0f172a;
  font-weight:bold;
}

button.joker-actif {
  background:#fde047; /* jaune doux */
}

button.joker-consomme {
  background:#dc2626; /* rouge */
  color:#ffffff;
}

/* ===== ZONES ===== */
.zone {
  border:2px dashed #475569;
  border-radius:12px;
  padding:10px;
  margin-bottom:14px;
}

.zone-title {
  text-align:center;
  margin-bottom:6px;
  color:#94a3b8;
}

.cartes {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
  min-height:110px;
}

/* ===== CARTES ===== */
.carte {
  width:70px;
  height:100px;
  background:#fff;
  border-radius:10px;
  color:#000;
  position:relative;
  box-shadow:0 4px 8px rgba(0,0,0,.4);
}

.carte.rouge { color:#b91c1c }

.carte.selectionnee {
  outline:3px solid #38bdf8;
  transform:translateY(-6px);
}

.valeur {
  position:absolute;
  top:6px;
  left:6px;
  font-weight:bold;
}

.centre {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2rem;
}

/* ===== ARCHIVES ===== */
.archive {
  position:relative;
}
  
.archives {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
}

.archive {
  border:2px solid #475569;
  border-radius:10px;
  padding:6px;
}

.archive h3 {
  text-align:center;
  margin-bottom:4px;
}

.archive-cartes {
  display:flex;
  flex-direction:column;
  gap:4px;
}

.joker-marqueur {
  position:absolute;
  top:-10px;
  right:-10px;
  font-size:1.2rem;
}

/* Cartes r√©duites dans les archives */
.archive-cartes .carte {
  width:42px;   /* 60 % de 70px */
  height:60px;  /* 60 % de 100px */
  font-size:0.8rem;
}
</style>
</head>

<body>

<h1>üÇ° L‚ÄôArchiviste</h1>

<button id="piocher">Piocher (2)</button>
<button id="defausser">D√©fausser</button>
<button id="joker">Activer Joker</button>

<div class="zone">
  <div class="zone-title">Zone Centrale</div>
  <div class="cartes" id="centre"></div>
</div>

<div class="zone">
  <div class="zone-title">Archives</div>
  <div class="archives">
    <div class="archive" data-c="‚ô†"><h3>‚ô†</h3><div class="archive-cartes"></div></div>
    <div class="archive" data-c="‚ô•"><h3 style="color:#b91c1c">‚ô•</h3><div class="archive-cartes"></div></div>
    <div class="archive" data-c="‚ô¶"><h3 style="color:#b91c1c">‚ô¶</h3><div class="archive-cartes"></div></div>
    <div class="archive" data-c="‚ô£"><h3>‚ô£</h3><div class="archive-cartes"></div></div>
  </div>
</div>

<script>
/* =====================================================
   √âTAT GLOBAL DU JEU
===================================================== */
const centre = document.getElementById("centre");
let pioche = [];
let etat = "pioche";            // "pioche" ou "action"
let jokerUtilise = false;
let jokerEnAttente = false;
document.getElementById("joker").classList.add("joker-actif");

const archives = { "‚ô†":[], "‚ô•":[], "‚ô¶":[], "‚ô£":[] };

const couleurs = ["‚ô†","‚ô•","‚ô¶","‚ô£"];
const valeurs = [
  ["A",1],["2",2],["3",3],["4",4],["5",5],
  ["6",6],["7",7],["8",8],["9",9],
  ["10",10],["D",12],["R",13]
];

/* =====================================================
   INITIALISATION DU PAQUET
===================================================== */
function creerPaquet(){
  document.getElementById("joker").className = "";
  pioche=[];
  couleurs.forEach(c=>{
    valeurs.forEach(v=>{
      pioche.push({ label:v[0], valeur:v[1], couleur:c });
    });
  });
  pioche.sort(()=>Math.random()-.5);
}

/* =====================================================
   CR√âATION HTML D‚ÄôUNE CARTE
===================================================== */
function creerCarteHTML(carte, interactive=true){
  const d=document.createElement("div");
  d.className="carte"+((carte.couleur==="‚ô•"||carte.couleur==="‚ô¶")?" rouge":"");
  d.dataset.valeur = carte.valeur;
  d.dataset.label = carte.label;
  d.dataset.couleur = carte.couleur;

  d.innerHTML = `
    <div class="valeur">${carte.label}</div>
    <div class="centre">${carte.couleur}</div>
  `;

  if(interactive){
    d.onclick = () => d.classList.toggle("selectionnee");
  }
  return d;
}

/* =====================================================
   PIOCHE
===================================================== */
document.getElementById("piocher").onclick = () => {
  if(etat !== "pioche") return;

  // Pioche interdite si piocher 2 cartes d√©passe 7 cartes
  if(centre.children.length + 2 > 7){
    alert("Zone Centrale satur√©e, pioche impossible");
    return;
  }

  for(let i=0;i<2;i++){
    if(pioche.length && centre.children.length < 7){
      centre.appendChild(creerCarteHTML(pioche.pop()));
    }
  }
  etat = "action";
};

/* =====================================================
   CLASSEMENT DANS LES ARCHIVES
===================================================== */
document.querySelectorAll(".archive").forEach(archive=>{
  archive.onclick = () => {
    
      // Gestion du Chaos (Joker en attente)
    if(jokerEnAttente){
      if(archives[archive.dataset.c].length === 0) return;
  
      pioche.push(...archives[archive.dataset.c]);
      archives[archive.dataset.c] = [];
      renderArchive(archive.dataset.c);
  
      // Marqueur visuel Joker
      archive.insertAdjacentHTML(
        "afterbegin",
        "<div class='joker-marqueur'>üÉè</div>"
      );
  
      jokerEnAttente = false;

      const btnJoker = document.getElementById("joker");
      btnJoker.classList.remove("joker-actif");
      btnJoker.classList.add("joker-consomme");
      
      return;
    }

    if(etat!=="action") return;
    const sel=[...document.querySelectorAll(".carte.selectionnee")];
    if(sel.length!==1) return;

    const d=sel[0];
    if(d.dataset.couleur !== archive.dataset.c) return;

    archives[archive.dataset.c].push({
      valeur:+d.dataset.valeur,
      label:d.dataset.label,
      couleur:d.dataset.couleur
    });

    d.remove();
    renderArchive(archive.dataset.c);
    etat="pioche";
    verifierVictoire();
  };
});

/* =====================================================
   RENDU DES ARCHIVES
===================================================== */
function renderArchive(c){
  const cont=document.querySelector(`.archive[data-c="${c}"] .archive-cartes`);
  cont.innerHTML="";
  archives[c]
    .sort((a,b)=>a.valeur-b.valeur)
    .forEach(carte=>{
      cont.appendChild(creerCarteHTML(carte,false));
    });
}

/* =====================================================
   D√âFAUSSE (R√àGLES COMPL√àTES)
===================================================== */
document.getElementById("defausser").onclick = () => {
  if(etat!=="action") return;

  const sel=[...document.querySelectorAll(".carte.selectionnee")];
  if(sel.length < 2) return;

  const v=sel.map(c=>+c.dataset.valeur).sort((a,b)=>a-b);

  // M√™me valeur
  if(v[0]===v[1]){
    sel.forEach(c=>c.remove());
    etat="pioche";
    return;
  }

  // 6 + 9 => rejouer sans piocher
  if(v[0]===6 && v[1]===9){
    sel.forEach(c=>c.classList.remove("selectionnee"));
    return;
  }

  // 10 + Roi => vider zone centrale puis piocher 2
  if(v[0]===10 && v[1]===13){
    centre.innerHTML="";
    sel.forEach(c=>c.remove());
    etat="pioche";
    document.getElementById("piocher").click();
    return;
  }

  // 10 + As => regarder 3 cartes (simplifi√© : pas d‚Äôeffet UI ici)
  if(v[0]===1 && v[1]===10){
    sel.forEach(c=>c.remove());
    etat="pioche";
    return;
  }

  // 2 + 5 => d√©fausse 1 carte suppl√©mentaire au choix + pioche
  if(sel.length === 3){
    const valeursSel = sel.map(c => +c.dataset.valeur);
    const aUn2 = valeursSel.includes(2);
    const aUn5 = valeursSel.includes(5);
  
    if(aUn2 && aUn5){
      sel.forEach(c => c.remove());
      etat = "pioche";
      document.getElementById("piocher").click();
      return;
    }
  }
};

/* =====================================================
   JOKER / CHAOS
===================================================== */
  document.getElementById("joker").onclick = () => {
    if(jokerUtilise && !jokerEnAttente){
      alert("D√©faite ‚Äî Chaos incontr√¥l√©");
      location.reload();
    }
  
    // Emp√™cher activation si aucune archive n‚Äôa de cartes
    const nonVides = couleurs.filter(c => archives[c].length);
    if(nonVides.length === 0) return;
  
    jokerUtilise = true;
    jokerEnAttente = true;
  };

/* =====================================================
   CONDITION DE VICTOIRE
===================================================== */
function verifierVictoire(){
  couleurs.forEach(c=>{
    if(archives[c].length===10){
      alert("Victoire üèÜ Archive stabilis√©e");
    }
  });
}

/* =====================================================
   LANCEMENT
===================================================== */
creerPaquet();
</script>

</body>
</html>
